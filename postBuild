#!/bin/bash

# Define the path to your repo directory
REPO_DIR="$(pwd)"
TOOLS_DIR="$REPO_DIR/tools"

# Create the tools directory
mkdir -p $TOOLS_DIR

# Download and install DeepVariant
if [ ! -d "$TOOLS_DIR/deepvariant" ]; then
    git clone https://github.com/google/deepvariant.git $TOOLS_DIR/deepvariant
    cd $TOOLS_DIR/deepvariant
    ./build-prereq.sh
    ./build_release_binaries.sh
    cd -
fi

# Download and install GLnexus
if [ ! -d "$TOOLS_DIR/glnexus" ]; then
    git clone https://github.com/dnanexus-rnd/GLnexus.git $TOOLS_DIR/glnexus
    cd $TOOLS_DIR/glnexus
    ./install.sh
    cd -
fi

# Install HAIL using pip
pip install hail

# Ensure the binaries are executable
chmod +x $TOOLS_DIR/deepvariant/binaries/*
chmod +x $TOOLS_DIR/glnexus/build/glnexus_cli

# Add the tools' bin directories to PATH
export PATH=$TOOLS_DIR/deepvariant/binaries:$TOOLS_DIR/glnexus/build:$PATH

# Optionally, add the path to .bashrc for persistence
echo "export PATH=$TOOLS_DIR/deepvariant/binaries:$TOOLS_DIR/glnexus/build:\$PATH" >> ~/.bashrc

